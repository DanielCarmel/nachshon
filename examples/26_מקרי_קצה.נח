# ╔══════════════════════════════════════════════════════════════╗
# ║  דוגמה 26: מקרי קצה ובדיקות                                  ║
# ║  Example 26: Edge Cases and Testing                          ║
# ╚══════════════════════════════════════════════════════════════╝

הדפס("╔══════════════════════════════════════════╗")
הדפס("║  🧪 מקרי קצה ובדיקות                     ║")
הדפס("╚══════════════════════════════════════════╝")

# ===== מסגרת בדיקות פשוטה =====
מחלקה בדיקה:
    """מסגרת בדיקות פשוטה"""
    הגדר __אתחל__(עצמי, שם):
        עצמי.שם = שם
        עצמי.הצלחות = 0
        עצמי.כשלונות = 0
        עצמי.שגיאות = []
    
    הגדר טען_שווה(עצמי, מצופה, בפועל, תיאור):
        אם מצופה == בפועל:
            עצמי.הצלחות = עצמי.הצלחות + 1
            הדפס("  ✅ " + תיאור)
        אחרת:
            עצמי.כשלונות = עצמי.כשלונות + 1
            הודעה = "❌ " + תיאור + " - מצופה: " + מחרוזת(מצופה) + ", בפועל: " + מחרוזת(בפועל)
            עצמי.שגיאות = עצמי.שגיאות + [הודעה]
            הדפס("  " + הודעה)
    
    הגדר טען_אמת(עצמי, תנאי, תיאור):
        עצמי.טען_שווה(אמת, תנאי, תיאור)
    
    הגדר טען_שקר(עצמי, תנאי, תיאור):
        עצמי.טען_שווה(שקר, תנאי, תיאור)
    
    הגדר טען_ריק(עצמי, ערך, תיאור):
        עצמי.טען_שווה(ריק, ערך, תיאור)
    
    הגדר טען_לא_ריק(עצמי, ערך, תיאור):
        עצמי.טען_אמת(ערך != ריק, תיאור)
    
    הגדר סיכום(עצמי):
        סה_כ = עצמי.הצלחות + עצמי.כשלונות
        הדפס("\n📊 סיכום " + עצמי.שם + ":")
        הדפס("  סה\"כ: " + מחרוזת(סה_כ) + " בדיקות")
        הדפס("  הצלחות: " + מחרוזת(עצמי.הצלחות) + " ✅")
        הדפס("  כשלונות: " + מחרוזת(עצמי.כשלונות) + " ❌")
        אם עצמי.כשלונות == 0:
            הדפס("  🎉 כל הבדיקות עברו!")
        החזר עצמי.כשלונות == 0

# ===== 1. בדיקות מספרים =====
הדפס("\n1️⃣ מקרי קצה - מספרים:")
הדפס("═" * 40)

הגדר חלק_בטוח(מונה, מכנה):
    """חילוק בטוח שמטפל בחלוקה באפס"""
    אם מכנה == 0:
        החזר ריק
    החזר מונה / מכנה

הגדר מקסימום_ברשימה(רשימה):
    """מציאת מקסימום ברשימה"""
    אם רשימה == ריק או אורך(רשימה) == 0:
        החזר ריק
    מקס = רשימה[0]
    עבור איבר בתוך רשימה:
        אם איבר > מקס:
            מקס = איבר
    החזר מקס

הגדר ממוצע(רשימה):
    """חישוב ממוצע"""
    אם רשימה == ריק או אורך(רשימה) == 0:
        החזר ריק
    סכום = 0
    עבור מספר בתוך רשימה:
        סכום = סכום + מספר
    החזר סכום / אורך(רשימה)

בדיקה_מספרים = בדיקה("בדיקות מספרים")

# חילוק
בדיקה_מספרים.טען_שווה(5, חלק_בטוח(10, 2), "חילוק רגיל")
בדיקה_מספרים.טען_ריק(חלק_בטוח(10, 0), "חילוק באפס")
בדיקה_מספרים.טען_שווה(0, חלק_בטוח(0, 5), "אפס חלקי מספר")

# מקסימום
בדיקה_מספרים.טען_שווה(5, מקסימום_ברשימה([1, 5, 3]), "מקסימום רשימה רגילה")
בדיקה_מספרים.טען_שווה(7, מקסימום_ברשימה([7]), "מקסימום רשימה של איבר אחד")
בדיקה_מספרים.טען_ריק(מקסימום_ברשימה([]), "מקסימום רשימה ריקה")
בדיקה_מספרים.טען_שווה(-1, מקסימום_ברשימה([-5, -1, -3]), "מקסימום מספרים שליליים")

# ממוצע
בדיקה_מספרים.טען_שווה(2, ממוצע([1, 2, 3]), "ממוצע רגיל")
בדיקה_מספרים.טען_ריק(ממוצע([]), "ממוצע רשימה ריקה")

בדיקה_מספרים.סיכום()

# ===== 2. בדיקות מחרוזות =====
הדפס("\n2️⃣ מקרי קצה - מחרוזות:")
הדפס("═" * 40)

הגדר הפוך_מחרוזת(מחרוזת_קלט):
    """היפוך מחרוזת"""
    אם מחרוזת_קלט == ריק:
        החזר ריק
    אם אורך(מחרוזת_קלט) == 0:
        החזר ""
    תוצאה = ""
    עבור א בתוך טווח(אורך(מחרוזת_קלט) - 1, -1, -1):
        תוצאה = תוצאה + מחרוזת_קלט[א]
    החזר תוצאה

הגדר האם_פלינדרום(מחרוזת_קלט):
    """בדיקה אם מחרוזת היא פלינדרום"""
    אם מחרוזת_קלט == ריק:
        החזר שקר
    נקי = ""
    עבור תו בתוך מחרוזת_קלט.lower():
        אם תו.isalnum():
            נקי = נקי + תו
    החזר נקי == הפוך_מחרוזת(נקי)

הגדר ספור_תווים(מחרוזת_קלט, תו_לספור):
    """ספירת הופעות של תו"""
    אם מחרוזת_קלט == ריק או תו_לספור == ריק:
        החזר 0
    מונה = 0
    עבור תו בתוך מחרוזת_קלט:
        אם תו == תו_לספור:
            מונה = מונה + 1
    החזר מונה

בדיקה_מחרוזות = בדיקה("בדיקות מחרוזות")

# היפוך
בדיקה_מחרוזות.טען_שווה("םולש", הפוך_מחרוזת("שלום"), "היפוך מחרוזת")
בדיקה_מחרוזות.טען_שווה("", הפוך_מחרוזת(""), "היפוך מחרוזת ריקה")
בדיקה_מחרוזות.טען_שווה("א", הפוך_מחרוזת("א"), "היפוך תו בודד")
בדיקה_מחרוזות.טען_ריק(הפוך_מחרוזת(ריק), "היפוך ריק")

# פלינדרום
בדיקה_מחרוזות.טען_אמת(האם_פלינדרום("אבא"), "פלינדרום פשוט")
בדיקה_מחרוזות.טען_אמת(האם_פלינדרום("A man a plan a canal Panama"), "פלינדרום עם רווחים")
בדיקה_מחרוזות.טען_שקר(האם_פלינדרום("שלום"), "לא פלינדרום")
בדיקה_מחרוזות.טען_אמת(האם_פלינדרום(""), "מחרוזת ריקה היא פלינדרום")
בדיקה_מחרוזות.טען_אמת(האם_פלינדרום("א"), "תו בודד הוא פלינדרום")

# ספירת תווים
בדיקה_מחרוזות.טען_שווה(2, ספור_תווים("שלום לכם", "ל"), "ספירת תווים")
בדיקה_מחרוזות.טען_שווה(0, ספור_תווים("שלום", "ת"), "ספירת תו שלא קיים")
בדיקה_מחרוזות.טען_שווה(0, ספור_תווים("", "א"), "ספירה במחרוזת ריקה")

בדיקה_מחרוזות.סיכום()

# ===== 3. בדיקות רשימות =====
הדפס("\n3️⃣ מקרי קצה - רשימות:")
הדפס("═" * 40)

הגדר מזג_רשימות(רשימה1, רשימה2):
    """מיזוג שתי רשימות ממוינות"""
    אם רשימה1 == ריק:
        רשימה1 = []
    אם רשימה2 == ריק:
        רשימה2 = []
    
    תוצאה = []
    א = 0
    ב = 0
    
    כל_עוד א < אורך(רשימה1) וגם ב < אורך(רשימה2):
        אם רשימה1[א] <= רשימה2[ב]:
            תוצאה = תוצאה + [רשימה1[א]]
            א = א + 1
        אחרת:
            תוצאה = תוצאה + [רשימה2[ב]]
            ב = ב + 1
    
    כל_עוד א < אורך(רשימה1):
        תוצאה = תוצאה + [רשימה1[א]]
        א = א + 1
    
    כל_עוד ב < אורך(רשימה2):
        תוצאה = תוצאה + [רשימה2[ב]]
        ב = ב + 1
    
    החזר תוצאה

הגדר הסר_כפילויות(רשימה):
    """הסרת כפילויות תוך שמירה על סדר"""
    אם רשימה == ריק או אורך(רשימה) == 0:
        החזר []
    
    נראו = {}
    תוצאה = []
    עבור איבר בתוך רשימה:
        אם איבר לא_בתוך נראו:
            נראו[איבר] = אמת
            תוצאה = תוצאה + [איבר]
    החזר תוצאה

הגדר חתוך_רשימות(רשימה1, רשימה2):
    """מציאת איברים משותפים"""
    אם רשימה1 == ריק או רשימה2 == ריק:
        החזר []
    
    קבוצה2 = {}
    עבור איבר בתוך רשימה2:
        קבוצה2[איבר] = אמת
    
    תוצאה = []
    נראו = {}
    עבור איבר בתוך רשימה1:
        אם איבר בתוך קבוצה2 וגם איבר לא_בתוך נראו:
            תוצאה = תוצאה + [איבר]
            נראו[איבר] = אמת
    החזר תוצאה

בדיקה_רשימות = בדיקה("בדיקות רשימות")

# מיזוג
בדיקה_רשימות.טען_שווה([1, 2, 3, 4, 5, 6], מזג_רשימות([1, 3, 5], [2, 4, 6]), "מיזוג רשימות")
בדיקה_רשימות.טען_שווה([1, 2, 3], מזג_רשימות([1, 2, 3], []), "מיזוג עם רשימה ריקה")
בדיקה_רשימות.טען_שווה([1, 2, 3], מזג_רשימות([], [1, 2, 3]), "מיזוג רשימה ריקה עם מלאה")
בדיקה_רשימות.טען_שווה([], מזג_רשימות([], []), "מיזוג שתי רשימות ריקות")

# הסרת כפילויות
בדיקה_רשימות.טען_שווה([1, 2, 3], הסר_כפילויות([1, 2, 2, 3, 3, 3]), "הסרת כפילויות")
בדיקה_רשימות.טען_שווה([1], הסר_כפילויות([1, 1, 1]), "כל האיברים זהים")
בדיקה_רשימות.טען_שווה([], הסר_כפילויות([]), "רשימה ריקה")

# חיתוך
בדיקה_רשימות.טען_שווה([2, 3], חתוך_רשימות([1, 2, 3], [2, 3, 4]), "חיתוך רשימות")
בדיקה_רשימות.טען_שווה([], חתוך_רשימות([1, 2], [3, 4]), "חיתוך ללא משותפים")
בדיקה_רשימות.טען_שווה([], חתוך_רשימות([], [1, 2, 3]), "חיתוך עם רשימה ריקה")

בדיקה_רשימות.סיכום()

# ===== 4. בדיקות מילונים =====
הדפס("\n4️⃣ מקרי קצה - מילונים:")
הדפס("═" * 40)

הגדר קבל_בטוח(מילון, מפתח, ברירת_מחדל):
    """גישה בטוחה למילון"""
    אם מילון == ריק:
        החזר ברירת_מחדל
    אם מפתח בתוך מילון:
        החזר מילון[מפתח]
    החזר ברירת_מחדל

הגדר מזג_מילונים(מילון1, מילון2):
    """מיזוג שני מילונים"""
    תוצאה = {}
    אם מילון1 != ריק:
        עבור מפתח בתוך מילון1:
            תוצאה[מפתח] = מילון1[מפתח]
    אם מילון2 != ריק:
        עבור מפתח בתוך מילון2:
            תוצאה[מפתח] = מילון2[מפתח]
    החזר תוצאה

הגדר ספור_ערכים(רשימה):
    """ספירת הופעות של ערכים"""
    אם רשימה == ריק או אורך(רשימה) == 0:
        החזר {}
    
    מונים = {}
    עבור איבר בתוך רשימה:
        אם איבר בתוך מונים:
            מונים[איבר] = מונים[איבר] + 1
        אחרת:
            מונים[איבר] = 1
    החזר מונים

בדיקה_מילונים = בדיקה("בדיקות מילונים")

# גישה בטוחה
בדיקה_מילונים.טען_שווה(1, קבל_בטוח({"א": 1}, "א", 0), "גישה למפתח קיים")
בדיקה_מילונים.טען_שווה(0, קבל_בטוח({"א": 1}, "ב", 0), "גישה למפתח לא קיים")
בדיקה_מילונים.טען_שווה(-1, קבל_בטוח(ריק, "א", -1), "גישה למילון ריק")

# מיזוג
בדיקה_מילונים.טען_שווה({"א": 1, "ב": 2}, מזג_מילונים({"א": 1}, {"ב": 2}), "מיזוג מילונים")
בדיקה_מילונים.טען_שווה({"א": 2}, מזג_מילונים({"א": 1}, {"א": 2}), "מיזוג עם דריסה")
בדיקה_מילונים.טען_שווה({}, מזג_מילונים(ריק, ריק), "מיזוג מילונים ריקים")

# ספירת ערכים
בדיקה_מילונים.טען_שווה({"א": 2, "ב": 1}, ספור_ערכים(["א", "א", "ב"]), "ספירת ערכים")
בדיקה_מילונים.טען_שווה({}, ספור_ערכים([]), "ספירה ברשימה ריקה")

בדיקה_מילונים.סיכום()

# ===== 5. בדיקות גבולות =====
הדפס("\n5️⃣ מקרי קצה - גבולות:")
הדפס("═" * 40)

הגדר בטווח(ערך, מינימום, מקסימום):
    """בדיקה אם ערך בטווח"""
    החזר מינימום <= ערך <= מקסימום

הגדר חתוך_לטווח(ערך, מינימום, מקסימום):
    """חיתוך ערך לטווח נתון"""
    אם ערך < מינימום:
        החזר מינימום
    אם ערך > מקסימום:
        החזר מקסימום
    החזר ערך

הגדר נרמל(ערך, מינ_מקור, מקס_מקור, מינ_יעד, מקס_יעד):
    """נירמול ערך מטווח אחד לאחר"""
    אם מקס_מקור == מינ_מקור:
        החזר מינ_יעד
    יחס = (ערך - מינ_מקור) / (מקס_מקור - מינ_מקור)
    החזר מינ_יעד + יחס * (מקס_יעד - מינ_יעד)

בדיקה_גבולות = בדיקה("בדיקות גבולות")

# בדיקת טווח
בדיקה_גבולות.טען_אמת(בטווח(5, 1, 10), "ערך בתוך הטווח")
בדיקה_גבולות.טען_אמת(בטווח(1, 1, 10), "ערך על הגבול התחתון")
בדיקה_גבולות.טען_אמת(בטווח(10, 1, 10), "ערך על הגבול העליון")
בדיקה_גבולות.טען_שקר(בטווח(0, 1, 10), "ערך מתחת לטווח")
בדיקה_גבולות.טען_שקר(בטווח(11, 1, 10), "ערך מעל לטווח")

# חיתוך לטווח
בדיקה_גבולות.טען_שווה(5, חתוך_לטווח(5, 0, 10), "חיתוך - ערך בטווח")
בדיקה_גבולות.טען_שווה(0, חתוך_לטווח(-5, 0, 10), "חיתוך - ערך מתחת")
בדיקה_גבולות.טען_שווה(10, חתוך_לטווח(15, 0, 10), "חיתוך - ערך מעל")

# נירמול
בדיקה_גבולות.טען_שווה(50, נרמל(5, 0, 10, 0, 100), "נירמול באמצע")
בדיקה_גבולות.טען_שווה(0, נרמל(0, 0, 10, 0, 100), "נירמול מינימום")
בדיקה_גבולות.טען_שווה(100, נרמל(10, 0, 10, 0, 100), "נירמול מקסימום")

בדיקה_גבולות.סיכום()

# ===== 6. בדיקות תאריכים (סימולציה) =====
הדפס("\n6️⃣ מקרי קצה - תאריכים:")
הדפס("═" * 40)

הגדר שנה_מעוברת(שנה):
    """בדיקה אם שנה מעוברת"""
    אם שנה % 400 == 0:
        החזר אמת
    אם שנה % 100 == 0:
        החזר שקר
    אם שנה % 4 == 0:
        החזר אמת
    החזר שקר

הגדר ימים_בחודש(חודש, שנה):
    """מספר ימים בחודש"""
    ימים = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
    אם חודש < 1 או חודש > 12:
        החזר 0
    תוצאה = ימים[חודש - 1]
    אם חודש == 2 וגם שנה_מעוברת(שנה):
        תוצאה = 29
    החזר תוצאה

הגדר תאריך_תקין(יום, חודש, שנה):
    """בדיקת תקינות תאריך"""
    אם שנה < 1:
        החזר שקר
    אם חודש < 1 או חודש > 12:
        החזר שקר
    אם יום < 1 או יום > ימים_בחודש(חודש, שנה):
        החזר שקר
    החזר אמת

בדיקה_תאריכים = בדיקה("בדיקות תאריכים")

# שנה מעוברת
בדיקה_תאריכים.טען_אמת(שנה_מעוברת(2000), "2000 מעוברת (מתחלקת ב-400)")
בדיקה_תאריכים.טען_שקר(שנה_מעוברת(1900), "1900 לא מעוברת (מתחלקת ב-100)")
בדיקה_תאריכים.טען_אמת(שנה_מעוברת(2024), "2024 מעוברת")
בדיקה_תאריכים.טען_שקר(שנה_מעוברת(2023), "2023 לא מעוברת")

# ימים בחודש
בדיקה_תאריכים.טען_שווה(31, ימים_בחודש(1, 2024), "ינואר - 31 ימים")
בדיקה_תאריכים.טען_שווה(29, ימים_בחודש(2, 2024), "פברואר מעוברת - 29 ימים")
בדיקה_תאריכים.טען_שווה(28, ימים_בחודש(2, 2023), "פברואר רגילה - 28 ימים")
בדיקה_תאריכים.טען_שווה(0, ימים_בחודש(13, 2024), "חודש לא קיים")

# תאריך תקין
בדיקה_תאריכים.טען_אמת(תאריך_תקין(15, 6, 2024), "תאריך תקין")
בדיקה_תאריכים.טען_אמת(תאריך_תקין(29, 2, 2024), "29 בפברואר מעוברת")
בדיקה_תאריכים.טען_שקר(תאריך_תקין(29, 2, 2023), "29 בפברואר רגילה")
בדיקה_תאריכים.טען_שקר(תאריך_תקין(31, 4, 2024), "31 באפריל")
בדיקה_תאריכים.טען_שקר(תאריך_תקין(0, 1, 2024), "יום 0")

בדיקה_תאריכים.סיכום()

# ===== סיכום כללי =====
הדפס("\n" + "═" * 40)
הדפס("📋 סיכום כללי של כל הבדיקות")
הדפס("═" * 40)
הדפס("\n✨ סיום דוגמת מקרי קצה ובדיקות!")
