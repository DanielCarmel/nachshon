# ╔══════════════════════════════════════════════════════════════╗
# ║  דוגמה 24: דפוסי עיצוב (Design Patterns)                     ║
# ║  Example 24: Design Patterns                                 ║
# ╚══════════════════════════════════════════════════════════════╝

הדפס("╔══════════════════════════════════════════╗")
הדפס("║  🎨 דפוסי עיצוב בנחשון                   ║")
הדפס("╚══════════════════════════════════════════╝")

# ===== Singleton - יחידני =====
הדפס("\n1️⃣ דפוס יחידני (Singleton):")
הדפס("═" * 40)

מחלקה יחידני:
    """מחלקה שיכולה להיות לה רק מופע אחד"""
    _מופע = ריק
    
    הגדר קבל_מופע():
        אם יחידני._מופע == ריק:
            יחידני._מופע = {"נוצר": אמת, "מונה": 0}
        יחידני._מופע["מונה"] = יחידני._מופע["מונה"] + 1
        החזר יחידני._מופע

# בדיקה
מופע1 = יחידני.קבל_מופע()
מופע2 = יחידני.קבל_מופע()
מופע3 = יחידני.קבל_מופע()

הדפס("מונה גישות: " + מחרוזת(מופע1["מונה"]))
הדפס("האם אותו מופע? " + מחרוזת(מופע1 הוא מופע2))

# ===== Factory - מפעל =====
הדפס("\n🏭 דפוס מפעל (Factory):")
הדפס("═" * 40)

מחלקה חיה:
    הגדר __אתחל__(עצמי, שם):
        עצמי.שם = שם
    
    הגדר השמע_קול(עצמי):
        החזר "..."

מחלקה כלב(חיה):
    הגדר השמע_קול(עצמי):
        החזר "הב הב! 🐕"

מחלקה חתול(חיה):
    הגדר השמע_קול(עצמי):
        החזר "מיאו! 🐱"

מחלקה פרה(חיה):
    הגדר השמע_קול(עצמי):
        החזר "מוווו! 🐄"

מחלקה מפעל_חיות:
    """מפעל ליצירת חיות"""
    
    הגדר צור(סוג, שם):
        אם סוג == "כלב":
            החזר כלב(שם)
        אחרת_אם סוג == "חתול":
            החזר חתול(שם)
        אחרת_אם סוג == "פרה":
            החזר פרה(שם)
        אחרת:
            החזר חיה(שם)

# שימוש במפעל
רקס = מפעל_חיות.צור("כלב", "רקס")
מיצי = מפעל_חיות.צור("חתול", "מיצי")
שרה = מפעל_חיות.צור("פרה", "שרה")

עבור חיה בתוך [רקס, מיצי, שרה]:
    הדפס(חיה.שם + ": " + חיה.השמע_קול())

# ===== Observer - צופה =====
הדפס("\n👁️ דפוס צופה (Observer):")
הדפס("═" * 40)

מחלקה נושא:
    """נושא שצופים יכולים להירשם אליו"""
    
    הגדר __אתחל__(עצמי):
        עצמי.צופים = []
        עצמי.מצב = ריק
    
    הגדר הוסף_צופה(עצמי, צופה):
        עצמי.צופים = עצמי.צופים + [צופה]
    
    הגדר הסר_צופה(עצמי, צופה):
        צופים_חדשים = []
        עבור צ בתוך עצמי.צופים:
            אם צ != צופה:
                צופים_חדשים = צופים_חדשים + [צ]
        עצמי.צופים = צופים_חדשים
    
    הגדר הודע(עצמי):
        עבור צופה בתוך עצמי.צופים:
            צופה.עדכן(עצמי.מצב)
    
    הגדר שנה_מצב(עצמי, מצב_חדש):
        עצמי.מצב = מצב_חדש
        הדפס("  [נושא] מצב השתנה ל: " + מחרוזת(מצב_חדש))
        עצמי.הודע()

מחלקה צופה:
    הגדר __אתחל__(עצמי, שם):
        עצמי.שם = שם
    
    הגדר עדכן(עצמי, מצב):
        הדפס("  [" + עצמי.שם + "] קיבל עדכון: " + מחרוזת(מצב))

# דוגמה
תחנת_מזג_אוויר = נושא()
טלפון = צופה("טלפון")
טלוויזיה = צופה("טלוויזיה")
רדיו = צופה("רדיו")

תחנת_מזג_אוויר.הוסף_צופה(טלפון)
תחנת_מזג_אוויר.הוסף_צופה(טלוויזיה)
תחנת_מזג_אוויר.הוסף_צופה(רדיו)

הדפס("עדכון טמפרטורה:")
תחנת_מזג_אוויר.שנה_מצב("25°C ☀️")

הדפס("\nעדכון נוסף:")
תחנת_מזג_אוויר.שנה_מצב("18°C 🌧️")

# ===== Strategy - אסטרטגיה =====
הדפס("\n♟️ דפוס אסטרטגיה (Strategy):")
הדפס("═" * 40)

מחלקה אסטרטגיית_מיון:
    הגדר מיין(עצמי, נתונים):
        החזר נתונים

מחלקה מיון_עולה(אסטרטגיית_מיון):
    הגדר מיין(עצמי, נתונים):
        # מיון בועות פשוט
        תוצאה = נתונים[:]
        עבור א בתוך טווח(אורך(תוצאה)):
            עבור ב בתוך טווח(אורך(תוצאה) - 1):
                אם תוצאה[ב] > תוצאה[ב + 1]:
                    טמפ = תוצאה[ב]
                    תוצאה[ב] = תוצאה[ב + 1]
                    תוצאה[ב + 1] = טמפ
        החזר תוצאה

מחלקה מיון_יורד(אסטרטגיית_מיון):
    הגדר מיין(עצמי, נתונים):
        תוצאה = נתונים[:]
        עבור א בתוך טווח(אורך(תוצאה)):
            עבור ב בתוך טווח(אורך(תוצאה) - 1):
                אם תוצאה[ב] < תוצאה[ב + 1]:
                    טמפ = תוצאה[ב]
                    תוצאה[ב] = תוצאה[ב + 1]
                    תוצאה[ב + 1] = טמפ
        החזר תוצאה

מחלקה ממיין:
    הגדר __אתחל__(עצמי, אסטרטגיה):
        עצמי.אסטרטגיה = אסטרטגיה
    
    הגדר שנה_אסטרטגיה(עצמי, אסטרטגיה):
        עצמי.אסטרטגיה = אסטרטגיה
    
    הגדר מיין(עצמי, נתונים):
        החזר עצמי.אסטרטגיה.מיין(נתונים)

מספרים = [64, 34, 25, 12, 22, 11, 90]
הדפס("מספרים: " + מחרוזת(מספרים))

ממיין_שלי = ממיין(מיון_עולה())
הדפס("מיון עולה: " + מחרוזת(ממיין_שלי.מיין(מספרים)))

ממיין_שלי.שנה_אסטרטגיה(מיון_יורד())
הדפס("מיון יורד: " + מחרוזת(ממיין_שלי.מיין(מספרים)))

# ===== Decorator Pattern - מעטר =====
הדפס("\n🎀 דפוס מעטר (Decorator):")
הדפס("═" * 40)

מחלקה קפה:
    הגדר מחיר(עצמי):
        החזר 5
    
    הגדר תיאור(עצמי):
        החזר "קפה"

מחלקה תוספת_קפה:
    הגדר __אתחל__(עצמי, קפה):
        עצמי.קפה = קפה

מחלקה חלב(תוספת_קפה):
    הגדר מחיר(עצמי):
        החזר עצמי.קפה.מחיר() + 2
    
    הגדר תיאור(עצמי):
        החזר עצמי.קפה.תיאור() + " + חלב"

מחלקה סוכר(תוספת_קפה):
    הגדר מחיר(עצמי):
        החזר עצמי.קפה.מחיר() + 1
    
    הגדר תיאור(עצמי):
        החזר עצמי.קפה.תיאור() + " + סוכר"

מחלקה קצפת(תוספת_קפה):
    הגדר מחיר(עצמי):
        החזר עצמי.קפה.מחיר() + 3
    
    הגדר תיאור(עצמי):
        החזר עצמי.קפה.תיאור() + " + קצפת"

# בניית קפה עם תוספות
קפה_שלי = קפה()
הדפס(קפה_שלי.תיאור() + " = " + מחרוזת(קפה_שלי.מחיר()) + "₪")

קפה_שלי = חלב(קפה_שלי)
הדפס(קפה_שלי.תיאור() + " = " + מחרוזת(קפה_שלי.מחיר()) + "₪")

קפה_שלי = סוכר(קפה_שלי)
הדפס(קפה_שלי.תיאור() + " = " + מחרוזת(קפה_שלי.מחיר()) + "₪")

קפה_שלי = קצפת(קפה_שלי)
הדפס(קפה_שלי.תיאור() + " = " + מחרוזת(קפה_שלי.מחיר()) + "₪")

# ===== Builder - בנאי =====
הדפס("\n🔨 דפוס בנאי (Builder):")
הדפס("═" * 40)

מחלקה מחשב:
    הגדר __אתחל__(עצמי):
        עצמי.מעבד = "בסיסי"
        עצמי.זיכרון = "4GB"
        עצמי.דיסק = "256GB"
        עצמי.כרטיס_מסך = "משולב"
    
    הגדר __מחרוזת__(עצמי):
        החזר "מחשב: מעבד=" + עצמי.מעבד + ", RAM=" + עצמי.זיכרון + ", דיסק=" + עצמי.דיסק + ", GPU=" + עצמי.כרטיס_מסך

מחלקה בונה_מחשב:
    הגדר __אתחל__(עצמי):
        עצמי.מחשב = מחשב()
    
    הגדר הגדר_מעבד(עצמי, מעבד):
        עצמי.מחשב.מעבד = מעבד
        החזר עצמי
    
    הגדר הגדר_זיכרון(עצמי, זיכרון):
        עצמי.מחשב.זיכרון = זיכרון
        החזר עצמי
    
    הגדר הגדר_דיסק(עצמי, דיסק):
        עצמי.מחשב.דיסק = דיסק
        החזר עצמי
    
    הגדר הגדר_כרטיס_מסך(עצמי, gpu):
        עצמי.מחשב.כרטיס_מסך = gpu
        החזר עצמי
    
    הגדר בנה(עצמי):
        החזר עצמי.מחשב

# בניית מחשב גיימינג
בונה = בונה_מחשב()
מחשב_גיימינג = בונה.הגדר_מעבד("i9").הגדר_זיכרון("32GB").הגדר_דיסק("2TB SSD").הגדר_כרטיס_מסך("RTX 4090").בנה()
הדפס("🎮 " + מחרוזת(מחשב_גיימינג))

# בניית מחשב משרדי
בונה2 = בונה_מחשב()
מחשב_משרד = בונה2.הגדר_מעבד("i5").הגדר_זיכרון("16GB").בנה()
הדפס("💼 " + מחרוזת(מחשב_משרד))

# ===== State - מצב =====
הדפס("\n🔄 דפוס מצב (State):")
הדפס("═" * 40)

מחלקה מצב_מכונה:
    הגדר הכנס_מטבע(עצמי, מכונה):
        עבור
    
    הגדר לחץ_כפתור(עצמי, מכונה):
        עבור
    
    הגדר מסור_מוצר(עצמי, מכונה):
        עבור

מחלקה ממתין_למטבע(מצב_מכונה):
    הגדר הכנס_מטבע(עצמי, מכונה):
        הדפס("  💰 מטבע התקבל")
        מכונה.מצב = יש_מטבע()
    
    הגדר לחץ_כפתור(עצמי, מכונה):
        הדפס("  ❌ הכנס מטבע קודם")

מחלקה יש_מטבע(מצב_מכונה):
    הגדר הכנס_מטבע(עצמי, מכונה):
        הדפס("  ⚠️ כבר יש מטבע")
    
    הגדר לחץ_כפתור(עצמי, מכונה):
        הדפס("  🎰 מוציא מוצר...")
        מכונה.מצב = מוסר_מוצר()
        מכונה.מצב.מסור_מוצר(מכונה)

מחלקה מוסר_מוצר(מצב_מכונה):
    הגדר מסור_מוצר(עצמי, מכונה):
        הדפס("  🥤 קבל את המוצר!")
        מכונה.מצב = ממתין_למטבע()

מחלקה מכונת_ממכר:
    הגדר __אתחל__(עצמי):
        עצמי.מצב = ממתין_למטבע()
    
    הגדר הכנס_מטבע(עצמי):
        עצמי.מצב.הכנס_מטבע(עצמי)
    
    הגדר לחץ_כפתור(עצמי):
        עצמי.מצב.לחץ_כפתור(עצמי)

# שימוש
מכונה = מכונת_ממכר()
הדפס("ניסיון 1 - בלי מטבע:")
מכונה.לחץ_כפתור()

הדפס("\nניסיון 2 - עם מטבע:")
מכונה.הכנס_מטבע()
מכונה.לחץ_כפתור()

הדפס("\n✨ סיום דוגמת דפוסי עיצוב!")
