# ╔══════════════════════════════════════════════════════════════╗
# ║  דוגמה 25: מבני נתונים מתקדמים                               ║
# ║  Example 25: Advanced Data Structures                        ║
# ╚══════════════════════════════════════════════════════════════╝

הדפס("╔══════════════════════════════════════════╗")
הדפס("║  🗃️ מבני נתונים מתקדמים                  ║")
הדפס("╚══════════════════════════════════════════╝")

# ===== מחסנית (Stack) - LIFO =====
הדפס("\n1️⃣ מחסנית (Stack - LIFO):")
הדפס("═" * 40)

מחלקה מחסנית:
    """מבנה נתונים LIFO - אחרון נכנס ראשון יוצא"""
    
    הגדר __אתחל__(עצמי):
        עצמי.פריטים = []
    
    הגדר דחוף(עצמי, פריט):
        """הוסף פריט לראש המחסנית"""
        עצמי.פריטים = עצמי.פריטים + [פריט]
    
    הגדר שלוף(עצמי):
        """הוצא והחזר פריט מראש המחסנית"""
        אם עצמי.ריקה():
            החזר ריק
        פריט = עצמי.פריטים[אורך(עצמי.פריטים) - 1]
        עצמי.פריטים = עצמי.פריטים[:אורך(עצמי.פריטים) - 1]
        החזר פריט
    
    הגדר הצץ(עצמי):
        """הצץ בפריט העליון בלי להוציא"""
        אם עצמי.ריקה():
            החזר ריק
        החזר עצמי.פריטים[אורך(עצמי.פריטים) - 1]
    
    הגדר ריקה(עצמי):
        החזר אורך(עצמי.פריטים) == 0
    
    הגדר גודל(עצמי):
        החזר אורך(עצמי.פריטים)
    
    הגדר __מחרוזת__(עצמי):
        החזר "מחסנית" + מחרוזת(עצמי.פריטים)

# דוגמה - בדיקת סוגריים מאוזנים
הגדר סוגריים_מאוזנים(מחרוזת_קלט):
    """בדיקה אם סוגריים מאוזנים"""
    ערימה = מחסנית()
    פותחים = "([{"
    סוגרים = ")]}"
    זוגות = {")": "(", "]": "[", "}": "{"}
    
    עבור תו בתוך מחרוזת_קלט:
        אם תו בתוך פותחים:
            ערימה.דחוף(תו)
        אחרת_אם תו בתוך סוגרים:
            אם ערימה.ריקה():
                החזר שקר
            אם ערימה.שלוף() != זוגות[תו]:
                החזר שקר
    
    החזר ערימה.ריקה()

# בדיקות
ביטויים = ["((()))", "([{}])", "((())", "([)]", "{[()]}"]
עבור ביטוי בתוך ביטויים:
    תוצאה = "✅ מאוזן" אם סוגריים_מאוזנים(ביטוי) אחרת "❌ לא מאוזן"
    הדפס(ביטוי + " -> " + תוצאה)

# ===== תור (Queue) - FIFO =====
הדפס("\n2️⃣ תור (Queue - FIFO):")
הדפס("═" * 40)

מחלקה תור:
    """מבנה נתונים FIFO - ראשון נכנס ראשון יוצא"""
    
    הגדר __אתחל__(עצמי):
        עצמי.פריטים = []
    
    הגדר הכנס(עצמי, פריט):
        """הוסף פריט לסוף התור"""
        עצמי.פריטים = עצמי.פריטים + [פריט]
    
    הגדר הוצא(עצמי):
        """הוצא והחזר פריט מתחילת התור"""
        אם עצמי.ריק():
            החזר ריק
        פריט = עצמי.פריטים[0]
        עצמי.פריטים = עצמי.פריטים[1:]
        החזר פריט
    
    הגדר הצץ(עצמי):
        """הצץ בפריט הראשון בלי להוציא"""
        אם עצמי.ריק():
            החזר ריק
        החזר עצמי.פריטים[0]
    
    הגדר ריק(עצמי):
        החזר אורך(עצמי.פריטים) == 0
    
    הגדר גודל(עצמי):
        החזר אורך(עצמי.פריטים)
    
    הגדר __מחרוזת__(עצמי):
        החזר "תור" + מחרוזת(עצמי.פריטים)

# סימולציה של תור לקוחות
הדפס("סימולציה - תור לקוחות:")
תור_לקוחות = תור()
לקוחות = ["דני", "שרה", "מיכל", "יוסי", "רחל"]

עבור לקוח בתוך לקוחות:
    תור_לקוחות.הכנס(לקוח)
    הדפס("  ➡️ " + לקוח + " נכנס לתור")

הדפס("\nשירות לקוחות:")
כל_עוד לא תור_לקוחות.ריק():
    לקוח = תור_לקוחות.הוצא()
    הדפס("  ✅ " + לקוח + " קיבל שירות")

# ===== רשימה מקושרת (Linked List) =====
הדפס("\n3️⃣ רשימה מקושרת (Linked List):")
הדפס("═" * 40)

מחלקה צומת:
    """צומת ברשימה מקושרת"""
    הגדר __אתחל__(עצמי, נתון):
        עצמי.נתון = נתון
        עצמי.הבא = ריק

מחלקה רשימה_מקושרת:
    """רשימה מקושרת חד-כיוונית"""
    
    הגדר __אתחל__(עצמי):
        עצמי.ראש = ריק
        עצמי.אורך = 0
    
    הגדר הוסף_בהתחלה(עצמי, נתון):
        צומת_חדש = צומת(נתון)
        צומת_חדש.הבא = עצמי.ראש
        עצמי.ראש = צומת_חדש
        עצמי.אורך = עצמי.אורך + 1
    
    הגדר הוסף_בסוף(עצמי, נתון):
        צומת_חדש = צומת(נתון)
        אם עצמי.ראש == ריק:
            עצמי.ראש = צומת_חדש
        אחרת:
            נוכחי = עצמי.ראש
            כל_עוד נוכחי.הבא != ריק:
                נוכחי = נוכחי.הבא
            נוכחי.הבא = צומת_חדש
        עצמי.אורך = עצמי.אורך + 1
    
    הגדר מחק(עצמי, נתון):
        אם עצמי.ראש == ריק:
            החזר שקר
        
        אם עצמי.ראש.נתון == נתון:
            עצמי.ראש = עצמי.ראש.הבא
            עצמי.אורך = עצמי.אורך - 1
            החזר אמת
        
        נוכחי = עצמי.ראש
        כל_עוד נוכחי.הבא != ריק:
            אם נוכחי.הבא.נתון == נתון:
                נוכחי.הבא = נוכחי.הבא.הבא
                עצמי.אורך = עצמי.אורך - 1
                החזר אמת
            נוכחי = נוכחי.הבא
        החזר שקר
    
    הגדר חפש(עצמי, נתון):
        נוכחי = עצמי.ראש
        מיקום = 0
        כל_עוד נוכחי != ריק:
            אם נוכחי.נתון == נתון:
                החזר מיקום
            נוכחי = נוכחי.הבא
            מיקום = מיקום + 1
        החזר -1
    
    הגדר הפוך(עצמי):
        """הפוך את הרשימה"""
        קודם = ריק
        נוכחי = עצמי.ראש
        כל_עוד נוכחי != ריק:
            הבא = נוכחי.הבא
            נוכחי.הבא = קודם
            קודם = נוכחי
            נוכחי = הבא
        עצמי.ראש = קודם
    
    הגדר לרשימה(עצמי):
        תוצאה = []
        נוכחי = עצמי.ראש
        כל_עוד נוכחי != ריק:
            תוצאה = תוצאה + [נוכחי.נתון]
            נוכחי = נוכחי.הבא
        החזר תוצאה
    
    הגדר __מחרוזת__(עצמי):
        אם עצמי.ראש == ריק:
            החזר "רשימה ריקה"
        חלקים = []
        נוכחי = עצמי.ראש
        כל_עוד נוכחי != ריק:
            חלקים = חלקים + [מחרוזת(נוכחי.נתון)]
            נוכחי = נוכחי.הבא
        החזר " -> ".join(חלקים) + " -> ריק"

# דוגמה
רשימה = רשימה_מקושרת()
עבור מס בתוך [1, 2, 3, 4, 5]:
    רשימה.הוסף_בסוף(מס)

הדפס("רשימה: " + מחרוזת(רשימה))
הדפס("אורך: " + מחרוזת(רשימה.אורך))
הדפס("חיפוש 3: מיקום " + מחרוזת(רשימה.חפש(3)))

רשימה.הפוך()
הדפס("לאחר היפוך: " + מחרוזת(רשימה))

# ===== עץ בינארי (Binary Tree) =====
הדפס("\n4️⃣ עץ בינארי (Binary Tree):")
הדפס("═" * 40)

מחלקה צומת_עץ:
    הגדר __אתחל__(עצמי, ערך):
        עצמי.ערך = ערך
        עצמי.שמאל = ריק
        עצמי.ימין = ריק

מחלקה עץ_חיפוש_בינארי:
    """עץ חיפוש בינארי (BST)"""
    
    הגדר __אתחל__(עצמי):
        עצמי.שורש = ריק
    
    הגדר הכנס(עצמי, ערך):
        אם עצמי.שורש == ריק:
            עצמי.שורש = צומת_עץ(ערך)
        אחרת:
            עצמי._הכנס_רקורסיבי(עצמי.שורש, ערך)
    
    הגדר _הכנס_רקורסיבי(עצמי, צומת, ערך):
        אם ערך < צומת.ערך:
            אם צומת.שמאל == ריק:
                צומת.שמאל = צומת_עץ(ערך)
            אחרת:
                עצמי._הכנס_רקורסיבי(צומת.שמאל, ערך)
        אחרת:
            אם צומת.ימין == ריק:
                צומת.ימין = צומת_עץ(ערך)
            אחרת:
                עצמי._הכנס_רקורסיבי(צומת.ימין, ערך)
    
    הגדר חפש(עצמי, ערך):
        החזר עצמי._חפש_רקורסיבי(עצמי.שורש, ערך)
    
    הגדר _חפש_רקורסיבי(עצמי, צומת, ערך):
        אם צומת == ריק:
            החזר שקר
        אם ערך == צומת.ערך:
            החזר אמת
        אם ערך < צומת.ערך:
            החזר עצמי._חפש_רקורסיבי(צומת.שמאל, ערך)
        החזר עצמי._חפש_רקורסיבי(צומת.ימין, ערך)
    
    הגדר סדר_תוכי(עצמי):
        """In-order traversal - מחזיר ממוין"""
        תוצאה = []
        עצמי._סדר_תוכי_רקורסיבי(עצמי.שורש, תוצאה)
        החזר תוצאה
    
    הגדר _סדר_תוכי_רקורסיבי(עצמי, צומת, תוצאה):
        אם צומת != ריק:
            עצמי._סדר_תוכי_רקורסיבי(צומת.שמאל, תוצאה)
            תוצאה.append(צומת.ערך)
            עצמי._סדר_תוכי_רקורסיבי(צומת.ימין, תוצאה)
    
    הגדר סדר_קדם(עצמי):
        """Pre-order traversal"""
        תוצאה = []
        עצמי._סדר_קדם_רקורסיבי(עצמי.שורש, תוצאה)
        החזר תוצאה
    
    הגדר _סדר_קדם_רקורסיבי(עצמי, צומת, תוצאה):
        אם צומת != ריק:
            תוצאה.append(צומת.ערך)
            עצמי._סדר_קדם_רקורסיבי(צומת.שמאל, תוצאה)
            עצמי._סדר_קדם_רקורסיבי(צומת.ימין, תוצאה)
    
    הגדר גובה(עצמי):
        החזר עצמי._גובה_רקורסיבי(עצמי.שורש)
    
    הגדר _גובה_רקורסיבי(עצמי, צומת):
        אם צומת == ריק:
            החזר 0
        גובה_שמאל = עצמי._גובה_רקורסיבי(צומת.שמאל)
        גובה_ימין = עצמי._גובה_רקורסיבי(צומת.ימין)
        אם גובה_שמאל > גובה_ימין:
            החזר גובה_שמאל + 1
        החזר גובה_ימין + 1

# דוגמה
עץ = עץ_חיפוש_בינארי()
ערכים = [50, 30, 70, 20, 40, 60, 80]
הדפס("מכניסים: " + מחרוזת(ערכים))

עבור ערך בתוך ערכים:
    עץ.הכנס(ערך)

הדפס("סדר תוכי (ממוין): " + מחרוזת(עץ.סדר_תוכי()))
הדפס("סדר קדם: " + מחרוזת(עץ.סדר_קדם()))
הדפס("גובה העץ: " + מחרוזת(עץ.גובה()))
הדפס("חיפוש 40: " + מחרוזת(עץ.חפש(40)))
הדפס("חיפוש 100: " + מחרוזת(עץ.חפש(100)))

# ===== טבלת גיבוב (Hash Table) =====
הדפס("\n5️⃣ טבלת גיבוב (Hash Table):")
הדפס("═" * 40)

מחלקה טבלת_גיבוב:
    """מימוש טבלת גיבוב עם שרשור"""
    
    הגדר __אתחל__(עצמי, גודל):
        עצמי.גודל = גודל
        עצמי.טבלה = []
        עבור _ בתוך טווח(גודל):
            עצמי.טבלה = עצמי.טבלה + [[]]
        עצמי.מספר_פריטים = 0
    
    הגדר _חשב_גיבוב(עצמי, מפתח):
        """פונקציית גיבוב פשוטה"""
        סכום = 0
        עבור תו בתוך מחרוזת(מפתח):
            סכום = סכום + ord(תו)
        החזר סכום % עצמי.גודל
    
    הגדר הכנס(עצמי, מפתח, ערך):
        אינדקס = עצמי._חשב_גיבוב(מפתח)
        # בדיקה אם המפתח כבר קיים
        עבור זוג בתוך עצמי.טבלה[אינדקס]:
            אם זוג[0] == מפתח:
                # עדכון ערך קיים
                זוג[1] = ערך
                החזר
        # הוספת זוג חדש
        עצמי.טבלה[אינדקס] = עצמי.טבלה[אינדקס] + [[מפתח, ערך]]
        עצמי.מספר_פריטים = עצמי.מספר_פריטים + 1
    
    הגדר קבל(עצמי, מפתח):
        אינדקס = עצמי._חשב_גיבוב(מפתח)
        עבור זוג בתוך עצמי.טבלה[אינדקס]:
            אם זוג[0] == מפתח:
                החזר זוג[1]
        החזר ריק
    
    הגדר מחק(עצמי, מפתח):
        אינדקס = עצמי._חשב_גיבוב(מפתח)
        תא_חדש = []
        נמחק = שקר
        עבור זוג בתוך עצמי.טבלה[אינדקס]:
            אם זוג[0] != מפתח:
                תא_חדש = תא_חדש + [זוג]
            אחרת:
                נמחק = אמת
        עצמי.טבלה[אינדקס] = תא_חדש
        אם נמחק:
            עצמי.מספר_פריטים = עצמי.מספר_פריטים - 1
        החזר נמחק
    
    הגדר מכיל(עצמי, מפתח):
        החזר עצמי.קבל(מפתח) != ריק
    
    הגדר הדפס_סטטיסטיקות(עצמי):
        הדפס("  גודל טבלה: " + מחרוזת(עצמי.גודל))
        הדפס("  מספר פריטים: " + מחרוזת(עצמי.מספר_פריטים))
        מקסימום = 0
        עבור תא בתוך עצמי.טבלה:
            אם אורך(תא) > מקסימום:
                מקסימום = אורך(תא)
        הדפס("  שרשרת ארוכה ביותר: " + מחרוזת(מקסימום))

# דוגמה - ספר טלפונים
ספר_טלפונים = טבלת_גיבוב(10)

אנשים = [
    ["דני", "050-1234567"],
    ["שרה", "052-9876543"],
    ["מיכל", "054-5555555"],
    ["יוסי", "053-1111111"],
    ["רחל", "058-2222222"]
]

עבור אדם בתוך אנשים:
    ספר_טלפונים.הכנס(אדם[0], אדם[1])
    הדפס("  הוספתי: " + אדם[0] + " -> " + אדם[1])

הדפס("\nחיפוש:")
הדפס("  דני: " + מחרוזת(ספר_טלפונים.קבל("דני")))
הדפס("  שרה: " + מחרוזת(ספר_טלפונים.קבל("שרה")))
הדפס("  אבי (לא קיים): " + מחרוזת(ספר_טלפונים.קבל("אבי")))

הדפס("\nסטטיסטיקות:")
ספר_טלפונים.הדפס_סטטיסטיקות()

# ===== תור עדיפויות (Priority Queue) =====
הדפס("\n6️⃣ תור עדיפויות (Priority Queue):")
הדפס("═" * 40)

מחלקה תור_עדיפויות:
    """מימוש תור עדיפויות עם ערימה (min-heap)"""
    
    הגדר __אתחל__(עצמי):
        עצמי.ערימה = []
    
    הגדר הכנס(עצמי, עדיפות, פריט):
        עצמי.ערימה = עצמי.ערימה + [[עדיפות, פריט]]
        עצמי._העלה(אורך(עצמי.ערימה) - 1)
    
    הגדר _העלה(עצמי, אינדקס):
        כל_עוד אינדקס > 0:
            אינדקס_הורה = (אינדקס - 1) // 2
            אם עצמי.ערימה[אינדקס][0] < עצמי.ערימה[אינדקס_הורה][0]:
                # החלפה
                טמפ = עצמי.ערימה[אינדקס]
                עצמי.ערימה[אינדקס] = עצמי.ערימה[אינדקס_הורה]
                עצמי.ערימה[אינדקס_הורה] = טמפ
                אינדקס = אינדקס_הורה
            אחרת:
                צא
    
    הגדר הוצא_מינימום(עצמי):
        אם אורך(עצמי.ערימה) == 0:
            החזר ריק
        
        מינימום = עצמי.ערימה[0]
        אחרון = עצמי.ערימה[אורך(עצמי.ערימה) - 1]
        עצמי.ערימה = עצמי.ערימה[:אורך(עצמי.ערימה) - 1]
        
        אם אורך(עצמי.ערימה) > 0:
            עצמי.ערימה[0] = אחרון
            עצמי._הורד(0)
        
        החזר מינימום[1]
    
    הגדר _הורד(עצמי, אינדקס):
        גודל = אורך(עצמי.ערימה)
        כל_עוד אמת:
            קטן_ביותר = אינדקס
            שמאל = 2 * אינדקס + 1
            ימין = 2 * אינדקס + 2
            
            אם שמאל < גודל וגם עצמי.ערימה[שמאל][0] < עצמי.ערימה[קטן_ביותר][0]:
                קטן_ביותר = שמאל
            אם ימין < גודל וגם עצמי.ערימה[ימין][0] < עצמי.ערימה[קטן_ביותר][0]:
                קטן_ביותר = ימין
            
            אם קטן_ביותר != אינדקס:
                טמפ = עצמי.ערימה[אינדקס]
                עצמי.ערימה[אינדקס] = עצמי.ערימה[קטן_ביותר]
                עצמי.ערימה[קטן_ביותר] = טמפ
                אינדקס = קטן_ביותר
            אחרת:
                צא
    
    הגדר ריק(עצמי):
        החזר אורך(עצמי.ערימה) == 0

# סימולציה - תור חדר מיון
הדפס("סימולציה - חדר מיון בבית חולים:")
חדר_מיון = תור_עדיפויות()

מטופלים = [
    [3, "דני - כאב ראש"],
    [1, "שרה - התקף לב 🚨"],
    [2, "מיכל - שבר יד"],
    [5, "יוסי - הצטננות"],
    [1, "רחל - קשיי נשימה 🚨"],
    [4, "אבי - פציעה קלה"]
]

הדפס("\nמטופלים שמגיעים:")
עבור מטופל בתוך מטופלים:
    חדר_מיון.הכנס(מטופל[0], מטופל[1])
    הדפס("  ➡️ עדיפות " + מחרוזת(מטופל[0]) + ": " + מטופל[1])

הדפס("\nסדר טיפול (לפי דחיפות):")
מספר = 1
כל_עוד לא חדר_מיון.ריק():
    מטופל = חדר_מיון.הוצא_מינימום()
    הדפס("  " + מחרוזת(מספר) + ". " + מטופל)
    מספר = מספר + 1

הדפס("\n✨ סיום דוגמת מבני נתונים מתקדמים!")
